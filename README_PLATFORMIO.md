# ST7796 Display Test –¥–ª—è ESP32-S3 –∑ PlatformIO

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–∏—Å–ø–ª–µ—è ST7796 –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º LVGL –Ω–∞ ESP32-S3 —á–µ—Ä–µ–∑ PlatformIO.

## üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—ñ–Ω—ñ–≤

| –§—É–Ω–∫—Ü—ñ—è | GPIO |
|---------|------|
| LCD_CS  | 4    |
| LCD_RST | 5    |
| LCD_DC  | 6    |
| MOSI    | 16   |
| SCK     | 18   |
| MISO    | 15   |

## üìã –í–∏–º–æ–≥–∏

- **PlatformIO** (—Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è VS Code –∞–±–æ CLI)
- **ESP32-S3** –ø–ª–∞—Ç–∞
- **ST7796** –¥–∏—Å–ø–ª–µ–π 480x320

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç –≤ PlatformIO

```bash
cd E:\esp32\spi_st7796\st7796_test
```

–£ VS Code:
- `File ‚Üí Open Folder` ‚Üí –≤–∏–±–µ—Ä—ñ—Ç—å –ø–∞–ø–∫—É `st7796_test`
- PlatformIO –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –ø—Ä–æ–µ–∫—Ç

### 2. –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç—É

```bash
pio run
```

–ê–±–æ –≤ VS Code:
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —ñ–∫–æ–Ω–∫—É PlatformIO –Ω–∞ –ª—ñ–≤—ñ–π –ø–∞–Ω–µ–ª—ñ
- `Project Tasks ‚Üí esp32-s3-devkitc-1 ‚Üí General ‚Üí Build`

### 3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ø–ª–∞—Ç—É

```bash
pio run --target upload
```

–ê–±–æ –≤ VS Code:
- `Project Tasks ‚Üí esp32-s3-devkitc-1 ‚Üí General ‚Üí Upload`

### 4. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Serial –ø–æ—Ä—Ç—É

```bash
pio device monitor
```

–ê–±–æ –≤ VS Code:
- `Project Tasks ‚Üí esp32-s3-devkitc-1 ‚Üí General ‚Üí Monitor`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
st7796_test/
‚îú‚îÄ‚îÄ platformio.ini          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è PlatformIO
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îî‚îÄ‚îÄ lv_conf.h          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è LVGL
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp           # –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–¥ –∑ LVGL
‚îÇ   ‚îî‚îÄ‚îÄ simple_test.cpp.example  # –ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –±–µ–∑ LVGL
‚îî‚îÄ‚îÄ README_PLATFORMIO.md
```

## üéØ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç—É (–±–µ–∑ LVGL)

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –¥–∏—Å–ø–ª–µ–π –±–µ–∑ LVGL:

1. –ü–µ—Ä–µ–π–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª–∏:
```bash
mv src/main.cpp src/main_lvgl.cpp.backup
mv src/simple_test.cpp.example src/main.cpp
```

2. –ó–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ LVGL –≤ `platformio.ini`:
```ini
lib_deps = 
    bodmer/TFT_eSPI@^2.5.43
    # lvgl/lvgl@^8.3.11  ; –ó–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ
```

3. –ó–±–µ—Ä—ñ—Ç—å —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–æ–µ–∫—Ç –∑–Ω–æ–≤—É

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ó–º—ñ–Ω–∞ –ø—ñ–Ω—ñ–≤

–Ø–∫—â–æ –≤–∞—à—ñ –ø—ñ–Ω–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `platformio.ini`:

```ini
build_flags = 
    ; ... —ñ–Ω—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ...
    -DTFT_MISO=15    ; –í–∞—à –ø—ñ–Ω MISO
    -DTFT_MOSI=16    ; –í–∞—à –ø—ñ–Ω MOSI
    -DTFT_SCLK=18    ; –í–∞—à –ø—ñ–Ω SCK
    -DTFT_CS=4       ; –í–∞—à –ø—ñ–Ω CS
    -DTFT_DC=6       ; –í–∞—à –ø—ñ–Ω DC
    -DTFT_RST=5      ; –í–∞—à –ø—ñ–Ω RST
```

### –ó–º—ñ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∏ SPI

–î–ª—è –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤ –∑—ñ —à–≤–∏–¥–∫—ñ—Å—Ç—é:

```ini
-DSPI_FREQUENCY=40000000  ; 40 MHz (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
; –∞–±–æ
-DSPI_FREQUENCY=55000000  ; 55 MHz (—à–≤–∏–¥—à–µ, —è–∫—â–æ –ø—Ä–∞—Ü—é—î)
; –∞–±–æ
-DSPI_FREQUENCY=80000000  ; 80 MHz (–º–∞–∫—Å–∏–º—É–º, –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏)
```

### –í–∏–±—ñ—Ä —ñ–Ω—à–æ—ó –ø–ª–∞—Ç–∏ ESP32-S3

–Ø–∫—â–æ —É –≤–∞—Å —ñ–Ω—à–∞ –ø–ª–∞—Ç–∞, –∑–º—ñ–Ω—ñ—Ç—å –≤ `platformio.ini`:

```ini
[env:esp32-s3-devkitc-1]
board = esp32-s3-devkitc-1  ; –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à—É –ø–ª–∞—Ç—É
```

–î–æ—Å—Ç—É–ø–Ω—ñ –ø–ª–∞—Ç–∏ ESP32-S3:
- `esp32-s3-devkitc-1` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ DevKit)
- `esp32s3box` (ESP32-S3-BOX)
- `esp32-s3-devkitm-1` (DevKit-M)
- `lolin_s3` (Wemos Lolin S3)
- `adafruit_feather_esp32s3` (Adafruit Feather)

–ü–µ—Ä–µ–≥–ª—è–¥ –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø–ª–∞—Ç:
```bash
pio boards espressif32
```

## üêõ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–æ—Ä–æ–∂–Ω—ñ–π –µ–∫—Ä–∞–Ω

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–æ–≤–æ–¥—ñ–≤
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∂–∏–≤–ª–µ–Ω–Ω—è –¥–∏—Å–ø–ª–µ—è (3.3V –∞–±–æ 5V)
3. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–º–µ–Ω—à–∏—Ç–∏ —á–∞—Å—Ç–æ—Ç—É SPI:
   ```ini
   -DSPI_FREQUENCY=20000000
   ```
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Serial –≤–∏–≤—ñ–¥:
   ```bash
   pio device monitor
   ```

### –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó LVGL

1. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ `lv_conf.h` –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `include/`
2. –°–ø—Ä–æ–±—É–π—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   pio run --target clean
   pio run
   ```

### –ù–µ—Å—Ç–∞—á–∞ –ø–∞–º'—è—Ç—ñ

ESP32-S3 –º–∞—î –±–∞–≥–∞—Ç–æ –ø–∞–º'—è—Ç—ñ, –∞–ª–µ —è–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ PSRAM –≤ `platformio.ini`:
   ```ini
   board_build.arduino.memory_type = qio_opi
   ```

2. –ó–º–µ–Ω—à—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä –±—É—Ñ–µ—Ä—ñ–≤ LVGL –≤ `src/main.cpp`:
   ```cpp
   size_t bufSize = screenWidth * 20; // –ó–º–µ–Ω—à–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è
   ```

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∫–æ–ª—å–æ—Ä–∏

–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤ `include/lv_conf.h`:
```cpp
#define LV_COLOR_16_SWAP 1  // –ó–º—ñ–Ω—ñ—Ç—å 0 –Ω–∞ 1
```

–ê–±–æ –¥–æ–¥–∞–π—Ç–µ –≤ `platformio.ini`:
```ini
-DTFT_RGB_ORDER=TFT_BGR
```

### –î–∏—Å–ø–ª–µ–π –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∏–π

–ó–º—ñ–Ω—ñ—Ç—å –≤ `src/main.cpp`:
```cpp
tft.setRotation(1);  // –°–ø—Ä–æ–±—É–π—Ç–µ 0, 1, 2, –∞–±–æ 3
```

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

–í Serial Monitor –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:
```
================================
ST7796 Display Test - ESP32-S3
================================
LVGL Version: 8.3.11
Initializing display...
Display size: 480 x 320
Initializing LVGL...
Buffer size: 19200 pixels
Free heap: 321456
LVGL Initialized!
Test UI Created!
Free heap after UI: 298632
================================
Setup completed successfully!
================================
```

## üé® –î–µ–º–æ LVGL

–†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –≤ `src/main.cpp` –¥–ª—è —ñ–Ω—à–∏—Ö –¥–µ–º–æ:

```cpp
// –í setup() –ø—ñ—Å–ª—è createTestUI():
// lv_demo_widgets();     // –î–µ–º–æ –≤—ñ–¥–∂–µ—Ç—ñ–≤
// lv_demo_benchmark();   // –¢–µ—Å—Ç —à–≤–∏–¥–∫–æ—Å—Ç—ñ
// lv_demo_stress();      // –°—Ç—Ä–µ—Å-—Ç–µ—Å—Ç
```

## üîó –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ PlatformIO

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∑–∞–¥–∞—á
pio run --list-targets

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç—É
pio run --target clean

# –ó–±—ñ—Ä–∫–∞ –±–µ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
pio run

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±–µ–∑ –∑–±—ñ—Ä–∫–∏ (—è–∫—â–æ –≤–∂–µ –∑—ñ–±—Ä–∞–Ω–æ)
pio run --target upload --upload-port COM3

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫
pio lib update

# –°–ø–∏—Å–æ–∫ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫
pio lib list

# –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–ª–∞—Ç—É
pio boards esp32-s3-devkitc-1
```

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [PlatformIO Docs](https://docs.platformio.org/)
- [ESP32-S3 Docs](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/)
- [LVGL Docs](https://docs.lvgl.io/)
- [TFT_eSPI GitHub](https://github.com/Bodmer/TFT_eSPI)

## üí° –ü–æ—Ä–∞–¥–∏

1. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ–¥–≤—ñ–π–Ω—É –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—é** - ESP32-S3 –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–∞–º'—è—Ç—ñ
2. **–£–≤—ñ–º–∫–Ω—ñ—Ç—å PSRAM** - –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±—É—Ñ–µ—Ä—ñ–≤ —Ç–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö UI
3. **–û–ø—Ç–∏–º—ñ–∑—É–π—Ç–µ —á–∞—Å—Ç–æ—Ç—É SPI** - –ø–æ—á–Ω—ñ—Ç—å –∑ 40MHz, –ø–æ—Ç—ñ–º –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–π—Ç–µ
4. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ DMA** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –≤ TFT_eSPI –¥–ª—è ESP32-S3
5. **–ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ heap** - —Å—Ç–µ–∂—Ç–µ –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –ø–∞–º'—è—Ç—ñ —á–µ—Ä–µ–∑ Serial

## ‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

ESP32-S3 –ø–æ–∫–∞–∑—É—î –≤—ñ–¥–º—ñ–Ω–Ω—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:
- **CPU**: 240 MHz (dual-core)
- **PSRAM**: –î–æ 8MB (—è–∫—â–æ —î)
- **SPI**: –î–æ 80 MHz
- **FPS**: 30-60 fps –¥–ª—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–∏—Ö –∞–Ω—ñ–º–∞—Ü—ñ–π

–û—á—ñ–∫—É–≤–∞–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:
- –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É (480x320): ~15-20ms @ 40MHz SPI
- LVGL UI –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: 30+ fps
- –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: –ø–ª–∞–≤–Ω–∞ –±–µ–∑ lag

## üìù –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞–¥–∞—î—Ç—å—Å—è "—è–∫ —î" –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —ñ —Ç–µ—Å—Ç–æ–≤–∏—Ö —Ü—ñ–ª–µ–π.
